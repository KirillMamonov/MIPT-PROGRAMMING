WITH Sel AS 
(SELECT 
(SELECT 255*COUNT(*) FROM utV WHERE V_COLOR = 'R') - SUM(CASE WHEN Col = 'R' THEN B_VOL ELSE 0 END) R,
(SELECT 255*COUNT(*) FROM utV WHERE V_COLOR = 'G') - SUM(CASE WHEN Col = 'G' THEN B_VOL ELSE 0 END) G,
(SELECT 255*COUNT(*) FROM utV WHERE V_COLOR = 'B') - SUM(CASE WHEN Col = 'B' THEN B_VOL ELSE 0 END) B
FROM (SELECT *, (SELECT V_COLOR FROM utV WHERE V_ID = B_V_ID) Col FROM utB) X)

SELECT MIN(R)/255 FROM (SELECT R FROM Sel UNION ALL SELECT G FROM Sel UNION ALL SELECT B FROM Sel) T
